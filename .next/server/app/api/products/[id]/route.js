"use strict";(()=>{var e={};e.id=898,e.ids=[898],e.modules={8013:e=>{e.exports=require("mongodb")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6587:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>w,patchFetch:()=>b,requestAsyncStorage:()=>f,routeModule:()=>h,serverHooks:()=>x,staticGenerationAsyncStorage:()=>y});var s={};n.r(s),n.d(s,{DELETE:()=>g,GET:()=>m,PUT:()=>p});var r=n(9303),a=n(8716),i=n(3131),o=n(7070),c=n(4184),u=n(5637),l=n(8013),d=n(2321);async function m(e,{params:t}){try{let{id:e}=t;if(!e)return o.NextResponse.json({error:"Product ID is required"},{status:400});let n=null,s=[];if(console.log("Using mock data for product:",e),(n=d.H6.find(t=>t.slug===e||t.id===e))&&(s=d.H6.filter(t=>t.category===n.category&&t.slug!==e).slice(0,4)),console.log("Found product:",n?n.name:"Not found"),!n)return o.NextResponse.json({error:"Product not found"},{status:404});return o.NextResponse.json({product:n,relatedProducts:s,success:!0})}catch(e){return console.error("Error fetching product:",e),o.NextResponse.json({error:"Failed to fetch product",success:!1},{status:500})}}async function p(e,{params:t}){try{let{id:n}=t,s=await e.json();if(!l.ObjectId.isValid(n))return o.NextResponse.json({error:"Invalid product ID"},{status:400});if(Object.keys(s).length>0){let e=(0,u.q$)(s);if(!e.isValid)return o.NextResponse.json({error:"Validation failed",details:e.errors},{status:400})}let r={...s};s.name&&(r.name=(0,u.vJ)(s.name)),s.description&&(r.description=(0,u.vJ)(s.description)),s.category&&(r.category=(0,u.vJ)(s.category));let a=(await (0,c.N8)()).collection(c.Ul.PRODUCTS),i=await a.findOne({_id:new l.ObjectId(n)});if(!i)return o.NextResponse.json({error:"Product not found"},{status:404});if(r.name&&r.name!==i.name){let e=r.name.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");if(await a.findOne({slug:e,_id:{$ne:new l.ObjectId(n)}}))return o.NextResponse.json({error:"Product with this name already exists"},{status:409});r.slug=e}let d={...r,updatedAt:new Date},m=await a.updateOne({_id:new l.ObjectId(n)},{$set:d});if(0===m.matchedCount)return o.NextResponse.json({error:"Product not found"},{status:404});return o.NextResponse.json({message:"Product updated successfully",success:!0})}catch(e){return console.error("Error updating product:",e),o.NextResponse.json({error:"Failed to update product",success:!1},{status:500})}}async function g(e,{params:t}){try{let{id:e}=t;if(!l.ObjectId.isValid(e))return o.NextResponse.json({error:"Invalid product ID"},{status:400});let n=(await (0,c.N8)()).collection(c.Ul.PRODUCTS),s=await n.updateOne({_id:new l.ObjectId(e)},{$set:{active:!1,updatedAt:new Date}});if(0===s.matchedCount)return o.NextResponse.json({error:"Product not found"},{status:404});return o.NextResponse.json({message:"Product deleted successfully",success:!0})}catch(e){return console.error("Error deleting product:",e),o.NextResponse.json({error:"Failed to delete product",success:!1},{status:500})}}let h=new r.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/products/[id]/route",pathname:"/api/products/[id]",filename:"route",bundlePath:"app/api/products/[id]/route"},resolvedPagePath:"E:\\nanuk\\src\\app\\api\\products\\[id]\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:y,serverHooks:x}=h,w="/api/products/[id]/route";function b(){return(0,i.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:y})}},5637:(e,t,n)=>{function s(e){let t=[];if(e.name&&"string"==typeof e.name){let n=e.name.trim();(n.length<o.name.minLength||n.length>o.name.maxLength)&&t.push(`Name must be between ${o.name.minLength} and ${o.name.maxLength} characters`),/[<>"'&\{\}]/.test(n)&&t.push("Name contains invalid characters")}else t.push("Name is required");if(e.email&&"string"==typeof e.email){let n=e.email.trim().toLowerCase();o.email.pattern.test(n)||t.push("Invalid email format"),n.length>254&&t.push("Email address is too long")}else t.push("Email is required");if(e.country&&"string"==typeof e.country){let n=e.country.trim();n.length>o.country.maxLength&&t.push(`Country must be less than ${o.country.maxLength} characters`),/[<>"'&\{\}]/.test(n)&&t.push("Country contains invalid characters")}else t.push("Country is required");if(e.message&&"string"==typeof e.message){let n=e.message.trim();(n.length<o.message.minLength||n.length>o.message.maxLength)&&t.push(`Message must be between ${o.message.minLength} and ${o.message.maxLength} characters`)}else t.push("Message is required");if(e.phone&&"string"==typeof e.phone){let n=e.phone.trim();n.length>o.phone.maxLength&&t.push(`Phone must be less than ${o.phone.maxLength} characters`),/^[+\d\s\-\(\)]+$/.test(n)||t.push("Phone number contains invalid characters")}if(e.company&&"string"==typeof e.company){let n=e.company.trim();n.length>o.company.maxLength&&t.push(`Company must be less than ${o.company.maxLength} characters`),/[<>"'&\{\}]/.test(n)&&t.push("Company name contains invalid characters")}let n=[/<script[^>]*>.*?<\/script>/gi,/javascript:/gi,/on\w+\s*=/gi,/data:(?:text\/html|application\/javascript)/gi];for(let s of[e.name,e.message,e.company,e.productInterest])if("string"==typeof s){for(let e of n)if(e.test(s)){t.push("Invalid content detected");break}}return{isValid:0===t.length,errors:t}}function r(e){let t=[];if(e.name&&"string"==typeof e.name){let n=e.name.trim();(n.length<c.name.minLength||n.length>c.name.maxLength)&&t.push(`Name must be between ${c.name.minLength} and ${c.name.maxLength} characters`),/[<>"'&\{\}]/.test(n)&&t.push("Name contains invalid characters")}else t.push("Name is required");if(e.category&&"string"==typeof e.category){let n=e.category.trim();n.length>c.category.maxLength&&t.push(`Category must be less than ${c.category.maxLength} characters`),/[<>"'&\{\}]/.test(n)&&t.push("Category contains invalid characters")}else t.push("Category is required");if(e.description&&"string"==typeof e.description){let n=e.description.trim();(n.length<c.description.minLength||n.length>c.description.maxLength)&&t.push(`Description must be between ${c.description.minLength} and ${c.description.maxLength} characters`)}else t.push("Description is required");if(Array.isArray(e.images)){if(e.images.length<c.images.minItems)t.push(`At least ${c.images.minItems} image is required`);else for(let n of e.images)if("string"!=typeof n||!n.trim()){t.push("All images must be valid URLs");break}}else t.push("Images must be an array");if(e.specifications&&"object"==typeof e.specifications||t.push("Specifications are required"),Array.isArray(e.features)){if(e.features.length<c.features.minItems)t.push(`At least ${c.features.minItems} feature is required`);else for(let n of e.features)if("string"!=typeof n||!n.trim()){t.push("All features must be valid strings");break}}else t.push("Features must be an array");return e.slug&&"string"==typeof e.slug&&!/^[a-z0-9-]+$/.test(e.slug)&&t.push("Slug must contain only lowercase letters, numbers, and hyphens"),{isValid:0===t.length,errors:t}}function a(e){return"string"!=typeof e?"":e.trim().replace(/[<>"'&]/g,e=>({"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","&":"&amp;"})[e]||e).replace(/javascript:/gi,"").replace(/on\w+\s*=/gi,"").replace(/<script[^>]*>.*?<\/script>/gi,"").replace(/data:(?:text\/html|application\/javascript)/gi,"").substring(0,2e3)}function i(e){let t={name:e.name?a(e.name):"",email:e.email?a(e.email.toLowerCase().trim()):"",phone:e.phone?a(e.phone):void 0,country:e.country?a(e.country):"",company:e.company?a(e.company):void 0,productInterest:e.productInterest?a(e.productInterest):void 0,productId:e.productId?a(e.productId):void 0,productName:e.productName?a(e.productName):void 0,quantity:e.quantity?a(e.quantity):void 0,message:e.message?a(e.message):""};return Object.keys(t).forEach(e=>{(void 0===t[e]||""===t[e])&&"name"!==e&&"email"!==e&&"country"!==e&&"message"!==e&&delete t[e]}),t}n.d(t,{E8:()=>s,Us:()=>u,eI:()=>i,q$:()=>r,vJ:()=>a});let o={name:{required:!0,minLength:2,maxLength:100},email:{required:!0,pattern:/^[^\s@]+@[^\s@]+\.[^\s@]+$/},phone:{required:!1,maxLength:20},country:{required:!0,maxLength:50},company:{required:!1,maxLength:100},message:{required:!0,minLength:10,maxLength:2e3}},c={name:{required:!0,minLength:3,maxLength:200},category:{required:!0,maxLength:50},description:{required:!0,minLength:10,maxLength:500},images:{required:!0,minItems:1},features:{required:!0,minItems:1}},u={status:"new",priority:"medium",source:"website",notes:[],createdAt:new Date,updatedAt:new Date}},4184:(e,t,n)=>{let s;n.d(t,{M7:()=>u,N8:()=>o,Ul:()=>c,xN:()=>l});var r=n(8013);let a={maxPoolSize:10,serverSelectionTimeoutMS:5e3,socketTimeoutMS:45e3,family:4,tls:!0,tlsAllowInvalidCertificates:!1,tlsAllowInvalidHostnames:!1,retryWrites:!0,retryReads:!0,authSource:"admin"};function i(){return s||(s=new r.MongoClient("mongodb+srv://766282480qnm_db_user:13195622840Qbb@weili-website.x7cdvcd.mongodb.net/wellicases?retryWrites=true&w=majority&appName=WEILI-website&ssl=true&authSource=admin",a).connect())}async function o(){try{return(await i()).db("wellicases")}catch(e){throw console.error("Failed to connect to database:",e),Error("Database connection failed")}}let c={INQUIRIES:"inquiries",PRODUCTS:"products",USERS:"users",SETTINGS:"settings"};async function u(e=3){for(let t=0;t<e;t++)try{let e=await i();return await e.db("admin").command({ping:1}),console.log("✅ MongoDB connection successful"),!0}catch(n){if(console.error(`❌ MongoDB connection attempt ${t+1} failed:`,n.message),t===e-1)return console.error("❌ All MongoDB connection attempts failed"),console.warn("⚠️ This might be due to SSL/TLS compatibility issues on Windows"),console.warn("⚠️ The application will continue without database connection"),!1;await new Promise(e=>setTimeout(e,1e3*(t+1)))}return!1}async function l(){try{let e=await o();await Promise.all([e.collection(c.INQUIRIES).createIndexes([{key:{email:1}},{key:{createdAt:-1}},{key:{country:1}},{key:{productInterest:1}},{key:{status:1}}]).catch(e=>console.warn("Failed to create inquiries indexes:",e)),e.collection(c.PRODUCTS).createIndexes([{key:{name:"text",description:"text"}},{key:{category:1}},{key:{featured:1}},{key:{active:1}},{key:{slug:1},unique:!0}]).catch(e=>console.warn("Failed to create products indexes:",e))]),console.log("✅ Database indexes created successfully")}catch(e){console.error("❌ Failed to initialize database:",e),console.warn("Database initialization failed, continuing without indexes")}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),s=t.X(0,[948,972,321],()=>n(6587));module.exports=s})();